![scheme](https://github.com/gaan-d/java-filmorate/blob/add-database/scheme.png)

# java-filmorate
Template repository for Filmorate project.

### üìÑ `user`
–°–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö —Å–∏—Å—Ç–µ–º—ã.

| –ü–æ–ª–µ         | –¢–∏–ø        | –û–ø–∏—Å–∞–Ω–∏–µ                                |
|--------------|------------|-----------------------------------------|
| user_id      | bigint     | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á (PK), —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID      |
| email        | varchar(50)| –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è          |
| login        | varchar(20)| –õ–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è                      |
| name         | varchar(30)| –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è                        |
| birthday     | date       | –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ)       |

---

### üìÑ `film`
–°–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∏–ª—å–º–∞—Ö.

| –ü–æ–ª–µ               | –¢–∏–ø         | –û–ø–∏—Å–∞–Ω–∏–µ                              |
|--------------------|-------------|---------------------------------------|
| id                 | integer     | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á (PK), —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID    |
| name               | varchar     | –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ)        |
| description        | varchar(200)| –û–ø–∏—Å–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞                       |
| release_date       | timestamp   | –î–∞—Ç–∞ —Ä–µ–ª–∏–∑–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ)       |
| duration_in_minutes| bigint      | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ñ–∏–ª—å–º–∞ –≤ –º–∏–Ω—É—Ç–∞—Ö         |
| rating_id          | bigint      | –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É `mpa_rating`        |

---

### üìÑ `mpa_rating`
–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ MPA (Motion Picture Association).

| –ü–æ–ª–µ | –¢–∏–ø     | –û–ø–∏—Å–∞–Ω–∏–µ                            |
|------|---------|-------------------------------------|
| id   | bigint  | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á (PK)                 |
| name | varchar | –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ (G, PG, PG-13 –∏ —Ç.–¥.) |

---

### üìÑ `genre`
–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∂–∞–Ω—Ä–æ–≤ —Ñ–∏–ª—å–º–æ–≤.

| –ü–æ–ª–µ | –¢–∏–ø     | –û–ø–∏—Å–∞–Ω–∏–µ                 |
|------|---------|--------------------------|
| id   | integer | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á (PK)      |
| name | varchar | –ù–∞–∑–≤–∞–Ω–∏–µ –∂–∞–Ω—Ä–∞           |

---

### üìÑ `film_genre`
–°–≤—è–∑—ã–≤–∞–µ—Ç —Ñ–∏–ª—å–º—ã —Å –∂–∞–Ω—Ä–∞–º–∏ (–º–Ω–æ–≥–∏–µ –∫–æ –º–Ω–æ–≥–∏–º).

| –ü–æ–ª–µ     | –¢–∏–ø     | –û–ø–∏—Å–∞–Ω–∏–µ                             |
|----------|---------|--------------------------------------|
| film_id  | bigint  | –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–∞ `film.id`            |
| genre_id | integer | –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–∞ `genre.id`           |

> –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ—Å—Ç–∞–≤–Ω—ã–º: (`film_id`, `genre_id`).

---

### üìÑ `film_like`
–¢–∞–±–ª–∏—Ü–∞ –ª–∞–π–∫–æ–≤ —Ñ–∏–ª—å–º–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.

| –ü–æ–ª–µ     | –¢–∏–ø     | –û–ø–∏—Å–∞–Ω–∏–µ                               |
|----------|---------|----------------------------------------|
| film_id  | bigint  | –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–∞ `film.id`              |
| user_id  | bigint  | –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–∞ `user.user_id`         |

> –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á: (`film_id`, `user_id`).

---

### üìÑ `friendship`
–•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥—Ä—É–∂–±–µ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.

| –ü–æ–ª–µ         | –¢–∏–ø     | –û–ø–∏—Å–∞–Ω–∏–µ                                                   |
|--------------|---------|------------------------------------------------------------|
| user_id      | bigint  | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–∏–ª –∑–∞–ø—Ä–æ—Å –≤ –¥—Ä—É–∑—å—è         |
| friend_id    | bigint  | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä–æ–º—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∑–∞–ø—Ä–æ—Å                |
| is_confirmed | boolean | –ü—Ä–∏–∑–Ω–∞–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥—Ä—É–∂–±—ã (true ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞, false ‚Äî –Ω–µ—Ç) |

> –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ—Å—Ç–∞–≤–Ω—ã–º: (`user_id`, `friend_id`).

## üìö –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

### üé¨ –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ñ–∏–ª—å–º–æ–≤

```sql
SELECT * FROM film;
```

–° –∂–∞–Ω—Ä–∞–º–∏ –∏ —Ä–µ–π—Ç–∏–Ω–≥–æ–º MPA:

```sql
SELECT 
  f.*, 
  r.name AS mpa_rating,
  string_agg(g.name, ', ') AS genres
FROM film f
JOIN mpa_rating r ON f.rating_id = r.id
LEFT JOIN film_genre fg ON f.id = fg.film_id
LEFT JOIN genre g ON fg.genre_id = g.id
GROUP BY f.id, r.name;
```

---

### üë§ –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```sql
SELECT * FROM "user";
```

---

### üåü –¢–æ–ø N –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤

> –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü—ã `film_like`, –≥–¥–µ —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –ª–∞–π–∫–∏ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

```sql
SELECT 
  f.*, 
  COUNT(fl.user_id) AS like_count
FROM film f
LEFT JOIN film_like fl ON f.id = fl.film_id
GROUP BY f.id
ORDER BY like_count DESC
LIMIT N;
```

---

### üßë‚Äçü§ù‚Äçüßë –°–ø–∏—Å–æ–∫ –æ–±—â–∏—Ö –¥—Ä—É–∑–µ–π –º–µ–∂–¥—É –¥–≤—É–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

```sql
SELECT u.*
FROM "user" u
JOIN friendship f1 ON f1.friend_id = u.user_id AND f1.is_confirmed = true
JOIN friendship f2 ON f2.friend_id = u.user_id AND f2.is_confirmed = true
WHERE f1.user_id = :user1_id
  AND f2.user_id = :user2_id;
```
